{% extends 'store/base.html' %}
{% block title %}Товар {{ product.name }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2>{{ product.name }}</h2>

    <p>{{ product.description }}</p>

    <p><strong>Цена:</strong> {{ product.price }} ₽</p>
    <p><strong>Категория:</strong> {{ product.category.name }}</p>

    <p>
        <strong>Поставщик:</strong>
        {% if product.supplier %}
            <a href="{% url 'supplier_products' product.supplier.pk %}">
                {{ product.supplier.company_name }}
            </a>
        {% else %}
            <span class="text-muted">не указан</span>
        {% endif %}
    </p>

    {% if user.is_authenticated and user.is_customer %}
        <a href="{% url 'add_to_cart' product.pk %}" class="btn btn-success me-2">
            <i class="fas fa-cart-plus me-1"></i>Добавить в корзину
        </a>
        <a href="{% url 'cart' %}" class="btn btn-outline-primary">
            <i class="fas fa-shopping-cart me-1"></i>Перейти в корзину
        </a>
    {% endif %}

    <hr>

    {% if avg_rating %}
        <p><strong>Средний рейтинг:</strong> {{ avg_rating|floatformat:1 }} / 5</p>
    {% else %}
        <p><strong>Средний рейтинг:</strong> нет оценок</p>
    {% endif %}

    <h4>Отзывы</h4>
    {% if reviews %}
        {% for review in reviews %}
            <div class="mb-3 border rounded p-2">
                <div><strong>{{ review.user.username }}</strong> — {{ review.rating }} / 5</div>
                <div class="text-muted" style="font-size: 0.9rem;">
                    {{ review.created_at|date:"d.m.Y H:i" }}
                </div>
                <p class="mb-0">{{ review.text }}</p>
            </div>
        {% endfor %}
    {% else %}
        <p>Отзывов пока нет.</p>
    {% endif %}

    <hr>
    <h4>Оставить отзыв</h4>
    {% if user.is_authenticated %}
        <form method="post">
            {% csrf_token %}
            <div class="mb-3">
                <label for="id_rating" class="form-label">Оценка (1–5)</label>
                {{ form.rating }}
            </div>
            <div class="mb-3">
                <label for="id_text" class="form-label">Текст отзыва</label>
                {{ form.text }}
            </div>
            <button type="submit" class="btn btn-primary">Отправить</button>
        </form>
    {% else %}
        <p>Чтобы оставить отзыв, <a href="{% url 'login' %}">войдите в систему</a>.</p>
    {% endif %}
</div>
{% endblock %}
